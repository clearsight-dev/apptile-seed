# Rules and Best Practices

## Critical Rules (DO's)

1. **Always add nativeID props** to all View, Text, Image, etc. elements
   - Format: `pluginName-ElementType-descriptiveName`
   - Example: `myplugin-Text-title`, `myplugin-Button-submit`
   - This allows the platform to identify and interact with elements

2. **Always use useApptileWindowDims** instead of React Native's `useWindowDimensions`
   - Ensures correct dimensions in web preview
   - Required for proper platform integration

3. **Set height/width and flexGrow: 0 on root elements**
   ```javascript
   <View
     nativeID={'rootElement-' + id}
     style={{
       height,
       width,
       flexGrow: 0
     }}
   >
   ```
   - Prevents overflow and clipping issues
   - Ensures proper containment

4. **Use try-catch liberally** in all files except component.jsx
   - The platform wraps ReactComponent in an error boundary
   - Protect against crashes in other files

5. **Expose sensible properties** for customization:
   - Text on buttons and labels
   - Colors for text and backgrounds
   - Corner radius, padding, spacing
   - Images via assetEditor

6. **For ScrollViews**:
   - Set explicit width for horizontal scrolling
   - Set explicit height for vertical scrolling
   - Set `showsVerticalScrollIndicator={false}` and `showsHorizontalScrollIndicator={false}`
   - Without explicit dimensions, ScrollViews won't scroll

7. **Use useDispatch from react-redux** to get dispatch function:
   ```javascript
   import { useDispatch } from 'react-redux';
   const dispatch = useDispatch();
   ```
   - DO NOT expect dispatch as a prop

8. **Prefix console errors** with `[APPTILE_AGENT]` for easy debugging
   - Makes it easy to identify plugin-related errors
   - Example: `console.error('[APPTILE_AGENT] Failed to load data')`

## Critical Rules (DON'Ts)

1. **DO NOT** edit `widget.jsx` files - they are auto-generated
   - Changes will be lost during build
   - Only edit `component.jsx`

2. **DO NOT** edit `remoteCode/index.js` or `remoteCode/indexNav.js` - they are auto-generated
   - These files are regenerated by build scripts
   - Plugin registration happens automatically

3. **DO NOT** use React Native's `Modal` component - use `@gorhom/portal` instead
   - Modal doesn't work correctly in web preview
   - Portal ensures proper containment

4. **DO NOT** use any libraries outside the supported list
   - Only 11 libraries are supported
   - No Expo libraries allowed

5. **DO NOT** use emojis in code - use icons from Material Icons, FontAwesome, etc.
   - Looks unprofessional
   - Use icon libraries instead

6. **DO NOT** create README files
   - Not needed for plugins
   - Can break file operations

7. **DO NOT** use `date-fns` - use `moment` instead
   - Only moment is supported
   - date-fns is not available

8. **DO NOT** import static image resources - use assetEditor instead
   - Static imports not supported
   - Use asset library via assetEditor

9. **DO NOT** use `useWindowDimensions` from react-native - use `useApptileWindowDims`
   - Required for web preview compatibility
   - Critical for proper rendering

10. **DO NOT** expect `dispatch` as a prop - use `useDispatch()` hook
    - Dispatch is not passed as prop
    - Always use the hook

11. **DO NOT** use `useState` for tracking focus - use `useRef` instead
    - Prevents unnecessary re-renders
    - Avoids focus loss issues

12. **DO NOT** do optimistic updates unless explicitly requested
    - Can lead to complex logic
    - Often causes bugs

13. **DO NOT** use opacity 0 for initial animation states - use 0.2 minimum
    - Allows developers to see elements during debugging
    - Helps identify animation issues

## Best Practices

### Component Structure

1. **Export exactly 4 things** from component.jsx:
   - ReactComponent
   - WidgetConfig
   - WidgetEditors
   - PropertySettings

2. **Use Immutable.js correctly**:
   ```javascript
   // Get a value
   const value = model.get('propertyName');
   
   // Get nested value
   const nested = model.getIn(['parent', 'child']);
   ```

3. **Provide fallback values**:
   ```javascript
   const greeting = model.get('greeting') || 'Hello';
   const color = model.get('color') || '#000000';
   ```

### Styling

1. **Set explicit dimensions** on root elements
2. **Use flexGrow: 0** to prevent overflow
3. **Expose styling properties** via WidgetEditors
4. **Use consistent spacing** and padding

### Performance

1. **Minimize re-renders** - use useRef for non-visual state
2. **Use shallowEqual** with useSelector
3. **Memoize expensive calculations** with useMemo
4. **Avoid inline function definitions** in render

### Error Handling

1. **Use try-catch** in all files except component.jsx
2. **Provide meaningful error messages**
3. **Prefix errors** with [APPTILE_AGENT]
4. **Handle null/undefined** gracefully

### Testing

When creating plugins:
1. Test on both iOS and Android if possible
2. Test in web preview (runs at https://app.apptile.io)
3. Verify all nativeID props are present
4. Check that ScrollViews scroll properly
5. Verify modals/sheets work correctly with Portal
6. Test all exposed properties in the no-code editor

## Common Mistakes to Avoid

1. **Forgetting nativeID props** - Platform can't identify elements
2. **Using wrong dimensions hook** - Web preview breaks
3. **Not setting flexGrow: 0** - Elements overflow
4. **Using Modal instead of Portal** - Doesn't work in web preview
5. **Importing unsupported libraries** - Build fails
6. **Editing auto-generated files** - Changes are lost
7. **Not providing fallback values** - Crashes when props are undefined
8. **Using useState for focus** - Causes re-render loops

